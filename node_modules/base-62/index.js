var DEFAULT_B62_ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'

module.exports = (function () {
  var self = {}
  var b62alphabet = DEFAULT_B62_ALPHABET

  self.encode = function (b62num) {
    if (isNaN(b62num)) {
      throw new TypeError('b62num must be a number')
    } else {
      if (b62num === 0) {
        return '0'
      } else {
        var s = ''
        while (b62num > 0) {
          s = b62alphabet[b62num % 62] + s
          b62num = Math.floor(b62num / 62)
        }
        return s
      }
    }
  }

  self.decode = function (b62str) {
    if (typeof b62str === 'string' || b62str instanceof String) {
      var num = 0
      var b62chr = b62str.split('').reverse()
      b62chr.forEach(function (c, i) {
        num += b62alphabet.indexOf(c) * Math.pow(62, i)
      })
      return num
    } else {
      throw new TypeError('b62str must be a string')
    }
  }

  self.setAlphabet = function (alphabet) {
    if (typeof alphabet === 'string' || alphabet instanceof String) {
      var uniqueChars = []
      var arrayOfChars = alphabet.split('')

      if (arrayOfChars.length !== 62) {
        throw new Error('Alphabet must be 62 characters long')
      }

      arrayOfChars.forEach(function (char) {
        if (!~uniqueChars.indexOf(char)) uniqueChars.push(char)
      })

      if (uniqueChars.length !== 62) throw Error('You must use unique characters')

      b62alphabet = alphabet
    } else {
      throw new TypeError('Alphabet must be a string')
    }
  }

  return self
})()
